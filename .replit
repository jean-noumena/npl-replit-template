# NPL + React Replit Template
# Build frontends on Replit that connect to Noumena Cloud

run = "cd frontend && npm i && npm run dev"
entrypoint = "frontend/src/App.tsx"

hidden = [".config", "node_modules", ".git", "dist"]
modules = ["nodejs-20", "bash", "web"]

[nix]
channel = "stable-25_05"

[env]
PATH = "/home/runner/.npl/bin:${PATH}"

[[ports]]
localPort = 5173
externalPort = 80

[deployment]
run = ["sh", "-c", "cd frontend && npm i && npm run build && npm run preview"]

[agent]
expertMode = true

[workflows]
runButton = "Project"

[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Start Dev Server"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸš€ Full Setup"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "âš™ï¸ Generate Environment"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ“¦ Install Dependencies"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "â˜ï¸ Deploy to Cloud"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ”„ Generate API Client"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ‘¥ Provision Users"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ”‘ Configure Keycloak"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ—ï¸ Build Production"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "âœ… Validate NPL"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ§ª Run Tests"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "ğŸ§¹ Clean"

[[workflows.workflow]]
name = "Start Dev Server"
author = "agent"

[workflows.workflow.metadata]
outputType = "webview"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd frontend && npm i && npm run dev -- --host 0.0.0.0"
waitForPort = 5173

[[workflows.workflow]]
name = "ğŸš€ Full Setup"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make setup"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "âš™ï¸ Generate Environment"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make env"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ“¦ Install Dependencies"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make install"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "â˜ï¸ Deploy to Cloud"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make deploy"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ”„ Generate API Client"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make client"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ‘¥ Provision Users"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make users"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ”‘ Configure Keycloak"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make keycloak"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ—ï¸ Build Production"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make build"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "âœ… Validate NPL"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make check"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ§ª Run Tests"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make test"

[workflows.workflow.metadata]
outputType = "console"

[[workflows.workflow]]
name = "ğŸ§¹ Clean"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make clean"

[workflows.workflow.metadata]
outputType = "console"
